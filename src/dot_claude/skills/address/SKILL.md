---
name: address
description: PRのレビューコメントを精査し、妥当な指摘に対して修正案を作成する
allowed-tools: Skill(fetch-pr-context), Read, Grep, Glob
argument-hint: "[PR number | GitHub PR URL]"
---

# /address - レビュー対応

レビュー結果を確認し、妥当性を判断した上で修正案を作成する。
レビュアーの指摘がすべて正しいとは限らないため、各コメントを批判的に評価する。

## 使用方法

```
/address [PR番号 | GitHub PR URL]
```

### 引数の解釈

- **無引数**: 直前の会話に含まれるレビュー内容を対象とする。会話内にレビュー情報が見つからない場合はユーザーに確認する。
- **数値のみ**: PR番号として `fetch-pr-context` スキルに渡す
- **github.com を含むURL**: URL末尾からPR番号を抽出し（例: `https://github.com/owner/repo/pull/123` → `123`）、`fetch-pr-context` スキルに渡す

## 動作フロー

### Step 1: レビューコメントの取得

引数に応じてレビューコメントを取得する。

- **PR番号またはURLが与えられた場合**:
  `fetch-pr-context` スキルをPR番号を引数として呼び出す。
  Step 3（GraphQL）まで実行し、未解決スレッド（`isResolved == false`）に絞り込む。
- **無引数の場合**:
  直前の会話からレビュー内容を特定する。
  会話内にレビュー情報が見つからない場合、ユーザーにPR番号の入力を促す。

### Step 2: 各コメントの妥当性評価

取得した各コメントに対して以下を評価する:

1. **技術的正確性** — 指摘は技術的に正しいか
2. **プロジェクト整合性** — プロジェクトの方針・規約と合致するか
   - 判断のため、指摘対象のファイルとその周辺コードを Read/Grep/Glob で確認する
3. **トレードオフの妥当性** — 実装上のトレードオフとして合理的か
4. **重複・既対応の確認** — 既に対応済み、または他の指摘と重複していないか

指摘が0件の場合、その旨をユーザーに報告して終了する。

### Step 3: 修正案の作成

妥当と判断した指摘に対して、具体的な修正案を作成する。

- **コードブロックで差分を示す**: 変更前・変更後を明示する
- **修正理由を添える**: なぜその修正が適切かを簡潔に説明する
- **副作用を検討する**: 修正によって新たな問題が発生しないか確認する

### Step 4: サマリーの出力

以下の形式でサマリーを出力する。

## サマリーの形式

```markdown
## レビュー対応サマリー

### 指摘一覧
- [ ] 指摘1の概要
- [ ] 指摘2の概要
...

### 対応する指摘（修正案）
| 指摘 | 修正案 | 対象ファイル |
|------|--------|-------------|
| 指摘1 | 修正案の概要 | `path/to/file` |
| 指摘2 | 修正案の概要 | `path/to/file` |

### 修正案の詳細

#### 指摘1: [指摘の概要]

**レビュアーのコメント**: [原文の要約]

**修正案**:
```diff
- 変更前のコード
+ 変更後のコード
```

**理由**: [この修正が適切である根拠]

---

(以下、各指摘について同様)

### 対応しない指摘
| 指摘 | 理由 |
|------|------|
| 指摘X | 対応不要と判断した理由 |
```

## 注意事項

- レビュアーの指摘を鵜呑みにせず、技術的妥当性を独自に判断する
- 対応しない場合は、レビュアーが納得できる理由を明記する
- 修正案は具体的なコードで示し、適用可能な形にする
- 修正案によって新たな問題が発生しないか確認する
